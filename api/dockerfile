FROM raspbian/stretch

WORKDIR /usr/src/app

RUN apt update -y && apt install -y python3.9 python3-pifacedigitalio python3-pip python3-venv
CMD "echo python --version"
RUN python3 -m venv /usr/src/api/venv
RUN . /usr/src/api/venv/bin/activate
RUN pip3 install --upgrade pip

COPY help/spi.py /usr/lib/python3/dist-packages/pifacecommon/spi.py


    # Adding the app directory where the server will run, then cd to its parent folder
RUN mkdir -p /usr/src/api/server
WORKDIR /usr/src/api

# Copy requirements.txt then install those dependencies
COPY requirements.txt ./server
RUN pip3 install -r ./server/requirements.txt

# Copy the app then enter that directory
COPY . ./server
WORKDIR /usr/src/api/server

# Start Gunicorn
ENTRYPOINT ["sh", "/usr/src/api/server/start_gunicorn.sh"]
